<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Agenda de viaje</title>

<style>
    /* --- FUENTE --- */
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #eef4ff; /* azul muy claro */
    }

    /* --- FONDO FIJO --- */
    body::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image: url('fondo_fuji.png');
        background-size: cover;
        background-position: center;
        opacity: 0.40;         /* ajuste de transparencia */
        z-index: -1;
    }

    /* --- CONTENEDOR GENERAL --- */
    .container {
        display: flex;
        gap: 20px;
        padding: 20px;
    }

    /* --- CALENDARIO --- */
    #calendar {
        background: rgba(255,255,255,0.75);
        padding: 20px;
        border-radius: 10px;
        flex-grow: 1;
    }

    /* --- TABLA --- */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 40px;
    }

    th {
        background: #d6e6ff;
        padding: 8px;
        border: 1px solid #aac6ff;
        font-weight: bold;
        text-align: center;
    }

    td {
        height: 90px;
        vertical-align: top;
        border: 1px solid #aac6ff;
        padding: 6px;
        background: rgba(220,235,255,0.55);
        position: relative;
    }

    /* DÃAS INAMOVIBLES */
    .fixed-day {
        background: rgba(120,170,255,0.80) !important;
    }

    /* ICONO CANDADO */
    .lock {
        font-size: 18px;
        position: absolute;
        top: 4px;
        right: 4px;
    }

    /* PANEL DERECHA */
    #editor {
        width: 300px;
        background: rgba(255,255,255,0.80);
        padding: 15px;
        border-radius: 10px;
    }

    textarea {
        width: 100%;
        height: 150px;
    }

    button {
        margin-top: 6px;
        padding: 6px 12px;
        cursor: pointer;
        background: #4a7bff;
        color: white;
        border: none;
        border-radius: 5px;
    }

    button:hover {
        background: #2f63e0;
    }

    /* MODO OSCURO */ 
    body.dark {
        background: #111;
        color: white;
    }

    body.dark #calendar,
    body.dark #editor {
        background: rgba(0,0,0,0.6);
    }

    body.dark th {
        background: #333;
        color: white;
    }

    body.dark td {
        background: rgba(50,50,50,0.7);
        border-color: #666;
    }

</style>
</head>
<body>

<div style="padding:20px; font-size:24px; font-weight:bold;">Agenda de viaje</div>

<div class="container">
    <div id="calendar"></div>

    <div id="editor">
        <h3 id="selectedDate">Seleccione un dÃ­a</h3>
        <textarea id="note"></textarea>

        <button onclick="saveNote()">Guardar</button>
        <button onclick="toggleFixed()">Marcar inamovible</button>
        <button onclick="deleteNote()">Borrar notas</button>
    </div>
</div>

<!-- ========================= -->
<!--       FIREBASE            -->
<!-- ========================= -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA-i2HNsKzwg5-xyEdQ2c_yOJ3fubhNLP4",
      authDomain: "agenda-viaje.firebaseapp.com",
      projectId: "agenda-viaje",
      storageBucket: "agenda-viaje.firebasestorage.app",
      messagingSenderId: "1016356002026",
      appId: "1:1016356002026:web:2065f2f5c7e34d6745df93"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    /* FECHAS */
    const start = new Date("2025-12-19");
    const end   = new Date("2026-01-17");

    let selected = null;
    let data = {};

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GENERAR CALENDARIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function generateCalendar() {
        let html = "";
        let current = new Date(start);

        const monthNames = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];

        while (current <= end) {
            let month = current.getMonth();
            let year  = current.getFullYear();

            html += `<h2>${monthNames[month]} ${year}</h2>`;
            html += `
                <table>
                    <tr>
                        <th>Lun</th><th>Mar</th><th>MiÃ©</th>
                        <th>Jue</th><th>Vie</th><th>SÃ¡b</th><th>Dom</th>
                    </tr>
                <tr>
            `;

            let firstDay = new Date(year,month,1).getDay();
            let offset = (firstDay === 0 ? 6 : firstDay - 1);

            for (let i=0; i<offset; i++) html += "<td></td>";

            let daysInMonth = new Date(year, month+1, 0).getDate();

            for (let day=1; day<=daysInMonth; day++) {
                let d = new Date(year, month, day);
                if (d < start || d > end) {
                    html += "<td></td>";
                } else {
                    let key = d.toISOString().slice(0,10);
                    let note = data[key]?.text || "";
                    let fixed = data[key]?.fixed;

                    html += `
                        <td onclick="selectDate('${key}')"
                            class="${fixed ? "fixed-day":""}">
                            <div>${day}</div>
                            ${fixed ? "<span class='lock'>ğŸ”’</span>":""}
                            <div style="font-size:12px; margin-top:4px;">${note.replace(/\n/g,"<br>")}</div>
                        </td>
                    `;
                }

                if ((offset + day) % 7 === 0) html += "</tr><tr>";
            }

            html += "</tr></table>";
            current = new Date(year, month+1, 1);
        }

        calendar.innerHTML = html;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SELECT DAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function selectDate(key) {
        selected = key;
        selectedDate.innerText = key;

        if (!data[key]) data[key] = {text:"", fixed:false};
        note.value = data[key].text;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SAVE NOTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function saveNote() {
        if (!selected) return;

        data[selected].text = note.value;

        await setDoc(doc(db,"agenda",selected), data[selected]);
        generateCalendar();
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DELETE NOTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function deleteNote() {
        if (!selected) return;

        data[selected].text = "";
        await setDoc(doc(db,"agenda",selected), data[selected]);
        note.value = "";
        generateCalendar();
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FIXED DAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function toggleFixed() {
        if (!selected) return;

        data[selected].fixed = !data[selected].fixed;
        await setDoc(doc(db,"agenda",selected), data[selected]);
        generateCalendar();
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LOAD FIREBASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function loadData() {
        let current = new Date(start);

        while (current <= end) {
            let key = current.toISOString().slice(0,10);
            let snap = await getDoc(doc(db,"agenda",key));

            if (snap.exists()) data[key] = snap.data();
            else data[key] = {text:"", fixed:false};

            current.setDate(current.getDate()+1);
        }

        generateCalendar();
    }

    loadData();
</script>

</body>
</html>
